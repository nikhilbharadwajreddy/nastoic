<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bawarchi Restaurant ‚Äî Enhanced Review</title>

  <!-- Load Clerk script from CDN -->
  <script
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@5/dist/clerk.browser.js"
    data-clerk-publishable-key="pk_live_Y2xlcmsubmFzdG9pYy5jb20k"
    defer
  ></script>
</head>
<body>
  <div class="container">
    <div class="review-card">
      <!-- Header with logo and sign out -->
      <div class="header">
        <div class="logo-container">
          <img src="https://restaurant-review-logos.s3.us-east-1.amazonaws.com/bawarchi.png" alt="Bawarchi Restaurant" class="logo">
        </div>
        <button id="sign-out" class="btn-secondary">Sign Out</button>
      </div>
      
      <!-- Progress indicator -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress" id="progress-indicator"></div>
        </div>
        <div class="steps-counter">
          <span id="current-step">1</span>/<span id="total-steps">4</span>
        </div>
      </div>
      
      <!-- Intro section -->
      <div class="intro-section">
        <h1>üìã Tell us about your experience</h1>
        <p class="intro-text">
          üë®‚Äçüç≥ Your dining experience drives our kitchen: every comment goes straight to the chef and manager, who'll fix any misses or celebrate the highlights.
        </p>
      </div>

      <!-- Multi-step form -->
      <form id="review-form">
        <!-- Hidden email field - will be populated from Clerk -->
        <input type="hidden" name="email" id="email" />
        
        <!-- Step 1: Personal Info -->
        <div class="form-step" id="step-1">
          <div class="form-group">
            <label for="dob">Date of Birth</label>
            <div class="dob-container">
              <select name="dob_month" id="dob_month" class="dob-select" required>
                <option value="" disabled selected>Month</option>
                <option value="01">January</option>
                <option value="02">February</option>
                <option value="03">March</option>
                <option value="04">April</option>
                <option value="05">May</option>
                <option value="06">June</option>
                <option value="07">July</option>
                <option value="08">August</option>
                <option value="09">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
              </select>
              
              <select name="dob_day" id="dob_day" class="dob-select" required>
                <option value="" disabled selected>Day</option>
                <option value="01">1</option>
                <option value="02">2</option>
                <option value="03">3</option>
                <option value="04">4</option>
                <option value="05">5</option>
                <option value="06">6</option>
                <option value="07">7</option>
                <option value="08">8</option>
                <option value="09">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
                <option value="31">31</option>
              </select>
              
              <select name="dob_year" id="dob_year" class="dob-select" required>
                <option value="" disabled selected>Year</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="2020">2020</option>
                <option value="2019">2019</option>
                <option value="2018">2018</option>
                <option value="2017">2017</option>
                <option value="2016">2016</option>
                <option value="2015">2015</option>
                <option value="2014">2014</option>
                <option value="2013">2013</option>
                <option value="2012">2012</option>
                <option value="2011">2011</option>
                <option value="2010">2010</option>
                <option value="2009">2009</option>
                <option value="2008">2008</option>
                <option value="2007">2007</option>
                <option value="2006">2006</option>
                <option value="2005">2005</option>
                <option value="2004">2004</option>
                <option value="2003">2003</option>
                <option value="2002">2002</option>
                <option value="2001">2001</option>
                <option value="2000">2000</option>
                <option value="1999">1999</option>
                <option value="1998">1998</option>
                <option value="1997">1997</option>
                <option value="1996">1996</option>
                <option value="1995">1995</option>
                <option value="1994">1994</option>
                <option value="1993">1993</option>
                <option value="1992">1992</option>
                <option value="1991">1991</option>
                <option value="1990">1990</option>
                <option value="1989">1989</option>
                <option value="1988">1988</option>
                <option value="1987">1987</option>
                <option value="1986">1986</option>
                <option value="1985">1985</option>
                <option value="1984">1984</option>
                <option value="1983">1983</option>
                <option value="1982">1982</option>
                <option value="1981">1981</option>
                <option value="1980">1980</option>
                <option value="1979">1979</option>
                <option value="1978">1978</option>
                <option value="1977">1977</option>
                <option value="1976">1976</option>
                <option value="1975">1975</option>
                <option value="1974">1974</option>
                <option value="1973">1973</option>
                <option value="1972">1972</option>
                <option value="1971">1971</option>
                <option value="1970">1970</option>
                <option value="1969">1969</option>
                <option value="1968">1968</option>
                <option value="1967">1967</option>
                <option value="1966">1966</option>
                <option value="1965">1965</option>
                <option value="1964">1964</option>
                <option value="1963">1963</option>
                <option value="1962">1962</option>
                <option value="1961">1961</option>
                <option value="1960">1960</option>
                <option value="1959">1959</option>
                <option value="1958">1958</option>
                <option value="1957">1957</option>
                <option value="1956">1956</option>
                <option value="1955">1955</option>
                <option value="1954">1954</option>
                <option value="1953">1953</option>
                <option value="1952">1952</option>
                <option value="1951">1951</option>
                <option value="1950">1950</option>
                <option value="1949">1949</option>
                <option value="1948">1948</option>
                <option value="1947">1947</option>
                <option value="1946">1946</option>
                <option value="1945">1945</option>
                <option value="1944">1944</option>
                <option value="1943">1943</option>
                <option value="1942">1942</option>
                <option value="1941">1941</option>
                <option value="1940">1940</option>
                <option value="1939">1939</option>
                <option value="1938">1938</option>
                <option value="1937">1937</option>
                <option value="1936">1936</option>
                <option value="1935">1935</option>
                <option value="1934">1934</option>
                <option value="1933">1933</option>
                <option value="1932">1932</option>
                <option value="1931">1931</option>
                <option value="1930">1930</option>
                <option value="1929">1929</option>
                <option value="1928">1928</option>
                <option value="1927">1927</option>
                <option value="1926">1926</option>
                <option value="1925">1925</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label>Gender</label>
            <div class="radio-group">
              <label class="radio-container">
                <input type="radio" name="gender" value="male" required>
                <span class="radio-label">Male</span>
              </label>
              <label class="radio-container">
                <input type="radio" name="gender" value="female">
                <span class="radio-label">Female</span>
              </label>
              <label class="radio-container">
                <input type="radio" name="gender" value="prefer_not_to_say">
                <span class="radio-label">Prefer not to say</span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label>Is today a special occasion?</label>
            <div class="radio-group">
              <label class="radio-container">
                <input type="radio" name="special_occasion" value="yes">
                <span class="radio-label">Yes</span>
              </label>
              <label class="radio-container">
                <input type="radio" name="special_occasion" value="no">
                <span class="radio-label">No</span>
              </label>
            </div>
            <p class="field-note">We love celebrating with our guests üéâ Let us know if today's special!</p>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-next" id="to-step-2">Next ‚Üí</button>
          </div>
        </div>
        
        <!-- Step 2: What did you eat + Food Rating -->
        <div class="form-step" id="step-2" style="display: none;">
          <div class="form-group">
            <label for="food_eaten">What did you eat today?</label>
            <input 
              type="text"
              id="food_eaten"
              name="food_eaten"
              placeholder="Enter the dishes you ordered"
              required
            />
          </div>
          
          <div class="form-group">
            <label>How was the food?</label>
            <div class="rating-container">
              <div class="stars" id="food-stars">
                <button type="button" class="star" data-value="1" aria-label="1 star">‚òÖ</button>
                <button type="button" class="star" data-value="2" aria-label="2 stars">‚òÖ</button>
                <button type="button" class="star" data-value="3" aria-label="3 stars">‚òÖ</button>
                <button type="button" class="star" data-value="4" aria-label="4 stars">‚òÖ</button>
                <button type="button" class="star" data-value="5" aria-label="5 stars">‚òÖ</button>
                <input type="hidden" name="food_rating" id="food_rating" value="0">
              </div>
              <div class="rating-label" id="food-rating-label">Tap to rate</div>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-back" id="back-to-step-1">‚Üê Back</button>
            <button type="button" class="btn-next" id="to-step-3" disabled>Next ‚Üí</button>
          </div>
        </div>
        
        <!-- Step 3: Food Review -->
        <div class="form-step" id="step-3" style="display: none;">
          <div class="form-group">
            <label for="food_review">Tell us more about the food</label>
            <textarea
              id="food_review"
              name="food_review"
              placeholder="What did you like or dislike about your meal?"
              rows="4"
              required
            ></textarea>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-back" id="back-to-step-2">‚Üê Back</button>
            <button type="button" class="btn-next" id="to-step-4">Next ‚Üí</button>
          </div>
        </div>
        
        <!-- Step 4: Ambience -->
        <div class="form-step" id="step-4" style="display: none;">
          <div class="form-group">
            <label>How was the ambience?</label>
            <div class="rating-container">
              <div class="stars" id="ambience-stars">
                <button type="button" class="star" data-value="1" aria-label="1 star">‚òÖ</button>
                <button type="button" class="star" data-value="2" aria-label="2 stars">‚òÖ</button>
                <button type="button" class="star" data-value="3" aria-label="3 stars">‚òÖ</button>
                <button type="button" class="star" data-value="4" aria-label="4 stars">‚òÖ</button>
                <button type="button" class="star" data-value="5" aria-label="5 stars">‚òÖ</button>
                <input type="hidden" name="ambience_rating" id="ambience_rating" value="0">
              </div>
              <div class="rating-label" id="ambience-rating-label">Tap to rate</div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="ambience_review">Any comments about the ambience?</label>
            <textarea
              id="ambience_review"
              name="ambience_review"
              placeholder="Tell us about your experience with the restaurant atmosphere (optional)"
              rows="3"
            ></textarea>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-back" id="back-to-step-3">‚Üê Back</button>
            <button type="submit" class="btn-submit">Submit Review</button>
          </div>
        </div>
      </form>
      
      <!-- Thank you modal (hidden by default) -->
      <div class="modal" id="thank-you-modal">
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-icon">‚úì</div>
            <h2>Thanks a ton! üôå</h2>
          </div>
          <div class="modal-body">
            <p>Your feedback is already with our chefs. We'll read it, we promise!</p>
            <p class="coupon-code">Here's 5% off your next visit: <strong>THANKYOU5</strong></p>
          </div>
          <div class="modal-footer">
            <button class="btn-primary" id="close-modal">Copy Coupon</button>
            <a href="#" class="google-review-link">Leave a Google Review too?</a>
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer-message">
      <p>Good food is made with feedback ‚Äì thank you! üçΩÔ∏è‚ù§Ô∏è</p>
    </div>
  </div>

  <style>
    :root {
      --brand-orange: #FF8C00;
      --text-primary: #333333;
      --text-secondary: #666666;
      --background-light: #F7F7F7;
      --background-white: #FFFFFF;
      --border-light: #E5E5E5;
      --error: #F44336;
      --success: #4CAF50;
      --primary-font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      --anim-duration: 0.2s;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: var(--primary-font);
      font-size: 16px;
      line-height: 1.5;
      color: var(--text-primary);
      background-color: var(--background-light);
    }
    
    .container {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .review-card {
      background-color: var(--background-white);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 32px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
    }
    
    .logo {
      height: 40px;
      width: auto;
    }
    
    .progress-container {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .progress-bar {
      flex: 1;
      height: 6px;
      background-color: var(--border-light);
      border-radius: 3px;
      overflow: hidden;
    }
    
    .progress {
      height: 100%;
      background-color: var(--brand-orange);
      width: 25%; /* 25% for 4 steps */
      transition: width var(--anim-duration) ease-in-out;
    }
    
    .steps-counter {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .intro-section {
      margin-bottom: 32px;
    }
    
    h1 {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .intro-text {
      color: var(--brand-orange);
      font-size: 15px;
      font-weight: 400;
      line-height: 1.4;
    }
    
    .form-step {
      animation: fadeIn var(--anim-duration) ease-in-out;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .field-note {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 6px;
      font-style: italic;
    }
    
    input[type="text"],
    textarea,
    .form-select {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      border: 1px solid var(--border-light);
      border-radius: 10px;
      background-color: var(--background-white);
      color: var(--text-primary);
      transition: all var(--anim-duration) ease;
    }
    
    input[type="text"]:focus,
    textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--brand-orange);
      box-shadow: 0 0 0 3px rgba(255, 140, 0, 0.2);
    }
    
    textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    /* Date of birth container */
    .dob-container {
      display: flex;
      gap: 10px;
    }
    
    .dob-select {
      flex: 1;
      padding: 14px 16px;
      font-size: 16px;
      border: 1px solid var(--border-light);
      border-radius: 10px;
      background-color: var(--background-white);
      color: var(--text-primary);
      cursor: pointer;
    }
    
    .dob-select:focus {
      outline: none;
      border-color: var(--brand-orange);
      box-shadow: 0 0 0 3px rgba(255, 140, 0, 0.2);
    }
    
    /* Radio buttons */
    .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 8px;
    }
    
    .radio-container {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    
    .radio-container input[type="radio"] {
      margin-right: 8px;
      accent-color: var(--brand-orange);
      width: 18px;
      height: 18px;
    }
    
    .radio-label {
      font-size: 16px;
      color: var(--text-primary);
    }
    
    .rating-container {
      margin-top: 12px;
    }
    
    .stars {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .star {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 32px;
      color: #D0D0D0;
      transition: transform var(--anim-duration) ease, color var(--anim-duration) ease;
      padding: 0;
    }
    
    .star:hover, 
    .star.selected {
      color: var(--brand-orange);
    }
    
    .star.selected {
      transform: scale(1.1);
    }
    
    .rating-label {
      font-size: 14px;
      color: var(--text-secondary);
      height: 20px;
    }
    
    .form-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 32px;
    }
    
    .btn-secondary {
      background-color: var(--background-light);
      color: var(--text-primary);
      border: none;
      border-radius: 50px;
      padding: 8px 14px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color var(--anim-duration) ease;
    }
    
    .btn-secondary:hover {
      background-color: #E0E0E0;
    }
    
    .btn-next,
    .btn-back,
    .btn-submit,
    .btn-primary {
      background-color: var(--brand-orange);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--anim-duration) ease;
    }
    
    .btn-next:hover,
    .btn-submit:hover,
    .btn-primary:hover {
      background-color: #E67500;
      transform: translateY(-1px);
    }
    
    .btn-next:disabled {
      background-color: #D0D0D0;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-back {
      background-color: var(--background-light);
      color: var(--text-primary);
    }
    
    .btn-back:hover {
      background-color: #E0E0E0;
    }
    
    .footer-message {
      text-align: center;
      margin-top: auto;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    /* Modal styling */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal.visible {
      display: flex;
    }
    
    .modal-content {
      background-color: var(--background-white);
      border-radius: 16px;
      padding: 32px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      position: relative;
    }
    
    .modal-header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .modal-icon {
      font-size: 48px;
      color: var(--success);
      margin-bottom: 16px;
    }
    
    .modal-body {
      margin-bottom: 24px;
      text-align: center;
    }
    
    .coupon-code {
      margin-top: 16px;
      padding: 16px;
      background-color: #FFF9F0;
      border-radius: 8px;
      border: 1px dashed var(--brand-orange);
      font-size: 14px;
    }
    
    .modal-footer {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .google-review-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
    }
    
    .google-review-link:hover {
      text-decoration: underline;
      color: var(--brand-orange);
    }
    
    .countdown-text {
      text-align: center;
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 16px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 600px) {
      .review-card {
        padding: 24px 20px;
        border-radius: 12px;
      }
      
      .form-actions {
        flex-direction: column;
        gap: 12px;
      }
      
      .btn-back, 
      .btn-next, 
      .btn-submit {
        width: 100%;
        justify-content: center;
      }
      
      .star {
        font-size: 28px;
      }
      
      .dob-container {
        flex-direction: column;
        gap: 8px;
      }
      
      .radio-group {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Wait for Clerk to initialize if it exists
        if (window.Clerk) {
          await Clerk.load();
          
          // Redirect to login if no session
          if (!Clerk.user) {
            window.location.href = '/';
            return;
          }
          
          // Store the email from Clerk in the hidden field
          if (Clerk.user.primaryEmailAddress) {
            document.getElementById('email').value = Clerk.user.primaryEmailAddress.emailAddress;
            console.log("User email set: " + Clerk.user.primaryEmailAddress.emailAddress);
          }
          
          // Setup sign out button
          const signOutBtn = document.getElementById('sign-out');
          if (signOutBtn) {
            signOutBtn.addEventListener('click', async () => {
              try {
                await Clerk.signOut();
                window.location.href = '/';
              } catch (error) {
                console.error('Error signing out:', error);
              }
            });
          }
        }
        
        // DOM elements
        const form = document.getElementById('review-form');
        const step1 = document.getElementById('step-1');
        const step2 = document.getElementById('step-2');
        const step3 = document.getElementById('step-3');
        const step4 = document.getElementById('step-4');
        const toStep2Button = document.getElementById('to-step-2');
        const toStep3Button = document.getElementById('to-step-3');
        const toStep4Button = document.getElementById('to-step-4');
        const backToStep1Button = document.getElementById('back-to-step-1');
        const backToStep2Button = document.getElementById('back-to-step-2');
        const backToStep3Button = document.getElementById('back-to-step-3');
        const progress = document.getElementById('progress-indicator');
        const currentStepEl = document.getElementById('current-step');
        const foodRatingInput = document.getElementById('food_rating');
        const ambienceRatingInput = document.getElementById('ambience_rating');
        const foodRatingLabel = document.getElementById('food-rating-label');
        const ambienceRatingLabel = document.getElementById('ambience-rating-label');
        const modal = document.getElementById('thank-you-modal');
        const closeModalButton = document.getElementById('close-modal');
        
        // Rating labels mapping
        const ratingLabels = {
          '0': 'Tap to rate',
          '1': 'Very disappointing',
          '2': 'Below average',
          '3': 'Decent',
          '4': 'Very good',
          '5': 'Amazing!'
        };
        
        // Handle star rating selection
        const setupStarRating = (containerId) => {
          const container = document.getElementById(containerId);
          const stars = container.querySelectorAll('.star');
          const type = containerId.split('-')[0]; // 'food' or 'ambience'
          const input = document.getElementById(`${type}_rating`);
          
          stars.forEach(star => {
            star.addEventListener('click', () => {
              const value = star.dataset.value;
              input.value = value;
              
              // Update visual state
              stars.forEach(s => {
                if (parseInt(s.dataset.value) <= parseInt(value)) {
                  s.classList.add('selected');
                } else {
                  s.classList.remove('selected');
                }
              });
              
              // Update rating label
              const label = document.getElementById(`${type}-rating-label`);
              label.textContent = ratingLabels[value] || ratingLabels['0'];
              
              // Enable next button if it's the food rating
              if (containerId === 'food-stars') {
                toStep3Button.disabled = false;
              }
            });
          });
        };
        
        // Navigation between steps
        const goToStep = (step) => {
          step1.style.display = 'none';
          step2.style.display = 'none';
          step3.style.display = 'none';
          step4.style.display = 'none';
          
          if (step === 1) {
            step1.style.display = 'block';
            progress.style.width = '25%';
            currentStepEl.textContent = '1';
          } else if (step === 2) {
            step2.style.display = 'block';
            progress.style.width = '50%';
            currentStepEl.textContent = '2';
          } else if (step === 3) {
            step3.style.display = 'block';
            progress.style.width = '75%';
            currentStepEl.textContent = '3';
          } else if (step === 4) {
            step4.style.display = 'block';
            progress.style.width = '100%';
            currentStepEl.textContent = '4';
          }
        };
        
        // Setup event listeners for navigation
        toStep2Button.addEventListener('click', () => goToStep(2));
        toStep3Button.addEventListener('click', () => goToStep(3));
        toStep4Button.addEventListener('click', () => goToStep(4));
        backToStep1Button.addEventListener('click', () => goToStep(1));
        backToStep2Button.addEventListener('click', () => goToStep(2));
        backToStep3Button.addEventListener('click', () => goToStep(3));
        
        // Setup star ratings
        setupStarRating('food-stars');
        setupStarRating('ambience-stars');
        
        // Form submission handler
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          
          // Get form data for submission
          const formData = new FormData(form);
          const reviewData = Object.fromEntries(formData);
          console.log('Review form submitted:', reviewData);
          
          try {
            // Here you would typically send the data to your backend
            // Add submission timestamp
            const submissionData = { 
              ...reviewData, 
              submittedAt: new Date().toISOString() 
            };
            
            console.log('Data ready for submission:', submissionData);
            
            // Store submission flag in localStorage (optional)
            localStorage.setItem('reviewSubmitted', 'true');
            
            // Generate a unique coupon code for the user
            const uniqueCoupon = 'THANKYOU' + Math.floor(Math.random() * 1000);
            document.querySelector('.coupon-code strong').textContent = uniqueCoupon;
            
            // Store the coupon code for future reference (optional)
            localStorage.setItem('userCoupon', uniqueCoupon);
          } catch (error) {
            console.warn('Error processing form data:', error);
            // Continue even if there's an error with the data processing
          }
          
          // Hide the form steps and show a simplified view
          document.querySelectorAll('.form-step').forEach(step => {
            step.style.display = 'none';
          });
          document.querySelector('.progress-container').style.display = 'none';
          document.querySelector('.intro-section').innerHTML = '<h1>Review Submitted! üéâ</h1><p class="intro-text">Thank you for sharing your feedback with us.</p>';
          
          // Show the thank you modal with coupon
          modal.classList.add('visible');
        });
        
        // Close modal button - copy coupon code
        closeModalButton.addEventListener('click', () => {
          try {
            // Attempt to copy the coupon code to clipboard
            const couponText = document.querySelector('.coupon-code strong').textContent;
            navigator.clipboard.writeText(couponText)
              .then(() => {
                alert('Coupon code copied to clipboard!');
                // Just hide the modal
                modal.classList.remove('visible');
              })
              .catch(() => {
                // If clipboard API fails, just hide the modal
                alert('Could not copy coupon automatically. Please copy it manually: ' + couponText);
                modal.classList.remove('visible');
              });
          } catch (error) {
            // Fallback if any error occurs
            alert('Could not copy coupon. Please copy it manually.');
            modal.classList.remove('visible');
          }
        });
        
        // Note: Clerk integration is now handled at the beginning of this script
        
      } catch (error) {
        console.error('Error initializing form:', error);
        alert('There was an error loading the review form. Please refresh or try again.');
      }
    });
  </script>
</body>
</html>